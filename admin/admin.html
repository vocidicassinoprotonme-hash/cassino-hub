<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cassino Hub • Admin</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121b2e; --muted:#9fb0d0; --text:#eef4ff;
      --acc:#5eead4; --acc2:#60a5fa; --danger:#fb7185; --warn:#fbbf24;
      --ok:#34d399; --line:#23304f;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#070b15,#0b1220);color:var(--text)}
    header{padding:16px 18px;border-bottom:1px solid var(--line);position:sticky;top:0;background:rgba(11,18,32,.92);backdrop-filter:blur(10px);z-index:5}
    header h1{margin:0;font-size:16px;font-weight:700;letter-spacing:.3px}
    header .sub{margin-top:4px;color:var(--muted);font-size:12px}
    main{padding:18px;max-width:1200px;margin:0 auto}
    .grid{display:grid;grid-template-columns:340px 1fr;gap:14px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:rgba(18,27,46,.92);border:1px solid var(--line);border-radius:16px;padding:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .row > *{flex:1}
    .btn{border:1px solid var(--line);background:#0f172a;color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:650}
    .btn:hover{border-color:#334166}
    .btn.acc{background:linear-gradient(90deg,rgba(94,234,212,.2),rgba(96,165,250,.2));border-color:#2c3d63}
    .btn.danger{background:rgba(251,113,133,.12);border-color:rgba(251,113,133,.3)}
    .btn.ok{background:rgba(52,211,153,.12);border-color:rgba(52,211,153,.3)}
    .btn.small{padding:8px 10px;font-size:12px;border-radius:10px}
    input,select,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #2b3a61;background:#0b1326;color:var(--text);outline:none}
    textarea{min-height:86px;resize:vertical}
    label{font-size:12px;color:var(--muted);display:block;margin:10px 0 6px}
    .tabs{display:flex;gap:10px;margin-top:12px}
    .tab{padding:10px 12px;border-radius:12px;border:1px solid var(--line);cursor:pointer;color:var(--muted)}
    .tab.active{color:var(--text);background:rgba(96,165,250,.12);border-color:rgba(96,165,250,.35)}
    .muted{color:var(--muted);font-size:12px}
    .list{display:grid;gap:10px}
    .item{padding:12px;border:1px solid var(--line);border-radius:14px;background:rgba(10,18,35,.7);cursor:pointer}
    .item:hover{border-color:#3a4b75}
    .item h4{margin:0 0 6px;font-size:14px}
    .badges{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:6px}
    .badge{font-size:11px;padding:3px 8px;border-radius:999px;border:1px solid #2b3a61;color:var(--muted)}
    .badge.ok{border-color:rgba(52,211,153,.4);color:rgba(52,211,153,.95)}
    .badge.warn{border-color:rgba(251,191,36,.4);color:rgba(251,191,36,.95)}
    .badge.danger{border-color:rgba(251,113,133,.4);color:rgba(251,113,133,.95)}
    .split{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:980px){.split{grid-template-columns:1fr}}
    .hr{height:1px;background:var(--line);margin:12px 0}
    .status{font-size:12px;color:var(--muted);margin-top:8px}
    .pill{font-size:12px;padding:4px 10px;border-radius:999px;border:1px solid var(--line);color:var(--muted)}
    .right{margin-left:auto}
    .kpi{display:flex;gap:10px;flex-wrap:wrap}
    .kpi .pill{background:rgba(96,165,250,.08)}
    .map{height:280px;border-radius:16px;border:1px solid var(--line);overflow:hidden;background:#0b1326}
    .hidden{display:none !important}
    .twoCols{display:grid;grid-template-columns:1fr 360px;gap:14px}
    @media(max-width:1120px){.twoCols{grid-template-columns:1fr}}
  </style>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
<header>
  <h1>Cassino Hub • Admin</h1>
  <div class="sub">Gestione segnalazioni + database (D1) per Places/Reviews</div>
</header>

<main>
  <div class="card">
    <div class="row">
      <div style="flex:2">
        <label>API Base (Worker)</label>
        <input id="apiBase" placeholder="https://cassino-segnalazioni.vocidicassinoproton-me.workers.dev" />
      </div>
      <div style="flex:1">
        <label>Admin Key (opzionale)</label>
        <input id="adminKey" placeholder="ak=..." />
      </div>
      <div style="flex:0 0 auto;align-self:flex-end">
        <button class="btn acc" id="btnSaveCfg">Salva</button>
      </div>

      <div class="right kpi" style="flex:0 0 auto;align-self:flex-end">
        <span class="pill" id="kpiReports">Reports: -</span>
        <span class="pill" id="kpiPlaces">Places: -</span>
        <span class="pill" id="kpiReviews">Reviews: -</span>
      </div>
    </div>
    <div class="status" id="cfgStatus"></div>
  </div>

  <div class="tabs">
    <div class="tab active" data-view="reports">Segnalazioni</div>
    <div class="tab" data-view="places">Places</div>
    <div class="tab" data-view="reviews">Reviews</div>
  </div>

  <div class="grid" style="margin-top:14px">

    <!-- LEFT: LIST -->
    <div class="card">
      <div id="viewReports">
        <div class="row">
          <select id="repStatus">
            <option value="all">Tutte</option>
            <option value="new" selected>Nuove</option>
            <option value="open">Aperte</option>
            <option value="closed">Chiuse</option>
          </select>
          <button class="btn" id="btnLoadReports">Carica</button>
        </div>
        <div class="status" id="repStatusText"></div>
        <div class="hr"></div>
        <div class="list" id="reportsList"></div>
      </div>

      <div id="viewPlaces" class="hidden">
        <div class="row">
          <button class="btn" id="btnLoadContent">Carica da API</button>
          <button class="btn acc" id="btnNewPlace">+ Nuovo</button>
        </div>
        <div class="status" id="ghStatus"></div>
        <div class="hr"></div>
        <div class="list" id="placesList"></div>
      </div>

      <div id="viewReviews" class="hidden">
        <div class="row">
          <button class="btn" id="btnLoadContent2">Carica da API</button>
          <button class="btn acc" id="btnNewReview">+ Nuovo</button>
        </div>
        <div class="status" id="ghStatus2"></div>
        <div class="hr"></div>
        <div class="list" id="reviewsList"></div>
      </div>
    </div>

    <!-- RIGHT: DETAIL -->
    <div class="card">
      <div id="detailEmpty" class="muted">Seleziona un elemento dalla lista.</div>

      <!-- REPORT DETAIL -->
      <div id="detailReport" class="hidden">
        <div class="twoCols">
          <div>
            <div class="badges" id="repBadges"></div>
            <h3 id="repTitle" style="margin:6px 0 8px"></h3>
            <div class="muted" id="repMeta"></div>
            <div class="hr"></div>
            <div id="repDesc" style="white-space:pre-wrap"></div>
            <div class="hr"></div>

            <label>Stato</label>
            <select id="repEditStatus">
              <option value="new">new</option>
              <option value="open">open</option>
              <option value="closed">closed</option>
            </select>

            <label>Tag</label>
            <input id="repTags" placeholder="es: sicurezza, buche, rifiuti" />

            <label>Nota admin</label>
            <textarea id="repNote" placeholder="nota interna"></textarea>

            <label>Risposta admin</label>
            <textarea id="repReply" placeholder="testo risposta"></textarea>

            <div class="row" style="margin-top:10px">
              <button class="btn ok" id="btnSaveReport">Salva</button>
              <span class="status" id="repSaveStatus"></span>
            </div>
          </div>

          <div>
            <div class="map" id="mapReport"></div>
            <div class="hr"></div>
            <div id="repPhotoBox" class="muted">Nessuna foto</div>
          </div>
        </div>
      </div>

      <!-- PLACE/REVIEW EDITOR -->
      <div id="detailEditor" class="hidden">
        <div class="row">
          <span class="badge" id="edMode">editor</span>
          <span class="muted" id="edId"></span>
          <div class="right"></div>
          <button class="btn danger small" id="btnDeleteItem">Elimina</button>
          <button class="btn small" id="btnCloseEditor">Chiudi</button>
        </div>

        <div class="hr"></div>

        <div id="editorPlace" class="hidden">
          <label>Nome</label>
          <input id="edName" />
          <label>Categoria</label>
          <input id="edCat" placeholder="posto / ristorante / negozio ..." />
          <label>Descrizione</label>
          <textarea id="edDesc"></textarea>

          <div class="split">
            <div>
              <label>Lat</label>
              <input id="edLat" />
            </div>
            <div>
              <label>Lng</label>
              <input id="edLng" />
            </div>
          </div>
        </div>

        <div id="editorReview" class="hidden">
          <label>Titolo</label>
          <input id="edTitle" />
          <label>Luogo (testo)</label>
          <input id="edPlace" />
          <label>Rating (1-5)</label>
          <input id="edRating" type="number" min="1" max="5" />
          <label>Testo</label>
          <textarea id="edText"></textarea>

          <div class="split">
            <div>
              <label>Lat</label>
              <input id="edLat2" />
            </div>
            <div>
              <label>Lng</label>
              <input id="edLng2" />
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="row">
          <button class="btn ok" id="btnSaveItem">Salva (in memoria)</button>
          <button class="btn acc" id="btnPublish">Pubblica</button>
          <span class="status" id="edStatus"></span>
        </div>

        <div class="hr"></div>
        <div class="map" id="mapEditor"></div>
      </div>
    </div>

  </div>
</main>

<script src="./admin.js"></script>
</body>
</html>
