<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>Admin â€¢ Cassino Hub</title>

  <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="./icons/icon-512.png">
  <link rel="stylesheet" href="../styles.css" />
  <link rel="preconnect" href="https://unpkg.com" />
  <link rel="manifest" href="./manifest.webmanifest" />

  <!-- Leaflet (mappa) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    .layout{display:grid;grid-template-columns:380px 1fr;gap:14px}
    .layout .card{height: calc(100vh - 170px); overflow:auto;}
    .map{height: calc(100vh - 170px); border-radius: 16px;}
    .mini{font-size:12px}
    .item{cursor:pointer}
    .item.active{outline:2px solid rgba(255,255,255,.25)}
    @media (max-width: 980px){
      .layout{grid-template-columns:1fr}
      .layout .card{height:auto}
      .map{height: 380px;}
    }
  </style>
</head>

<body>
  <header class="top">
    <div class="brand">
      <div class="logo">ðŸ”’</div>
      <div>
        <h1>Admin Segnalazioni</h1>
        <p>Controllo â€¢ Note â€¢ Risposte â€¢ Stato</p>
      </div>
    </div>
    <div class="row">
      <button id="btnRefresh" class="btn">Aggiorna</button>
      <button id="btnExport" class="btn secondary">Esporta JSON</button>
    </div>
  </header>

  <main class="container">
    <div class="card">
      <h3>Connessione</h3>

      <label class="field">
        <span>Worker base URL</span>
        <input id="apiBase" type="text" value="https://cassino-segnalazioni.vocidicassinoproton-me.workers.dev" />
      </label>

      <label class="field">
        <span>Admin Key (rimane solo nel browser)</span>
        <input id="adminKey" type="password" placeholder="incolla qui la chiave" />
      </label>

      <div class="row">
        <button id="btnSaveKey" class="btn">Salva</button>
        <button id="btnClearKey" class="btn danger">Rimuovi</button>
      </div>
      <p id="connStatus" class="muted mini"></p>
    </div>

    <div class="layout" style="margin-top:14px">
      <div class="card">
        <div class="row space">
          <h3>Segnalazioni</h3>
          <input id="q" type="text" placeholder="filtra titolo/descrizione" style="max-width:170px" />
        </div>
        <div id="list" class="list"></div>
      </div>

      <div class="card">
        <div class="row space">
          <h3>Dettaglio</h3>
          <span id="selMeta" class="muted mini"></span>
        </div>

        <div id="detailEmpty" class="muted">Seleziona una segnalazione a sinistra.</div>

        <div id="detail" class="hidden">
          <h4 id="dTitle"></h4>
          <p id="dDesc" class="muted"></p>

          <div id="dPhotoWrap" class="hidden" style="margin:10px 0">
            <img id="dPhoto" alt="" style="width:100%;border-radius:14px;border:1px solid var(--line)">
          </div>

          <p id="dCoords" class="muted mini"></p>

          <hr>

          <div class="grid2">
            <label class="field">
              <span>Status</span>
              <select id="dStatus">
                <option value="new">new</option>
                <option value="open">open</option>
                <option value="in_progress">in_progress</option>
                <option value="closed">closed</option>
              </select>
            </label>

            <label class="field">
              <span>Tags (separate da virgola)</span>
              <input id="dTags" type="text" placeholder="es. strade, sicurezza, rifiuti" />
            </label>
          </div>

          <label class="field">
            <span>Nota interna (solo admin)</span>
            <textarea id="dNote" rows="3" placeholder="Nota interna..."></textarea>
          </label>

          <label class="field">
            <span>Risposta al cittadino (testo)</span>
            <textarea id="dReply" rows="3" placeholder="Risposta..."></textarea>
          </label>

          <div class="row">
            <button id="btnSave" class="btn">Salva modifiche</button>
          </div>

          <p id="saveStatus" class="muted mini"></p>

          <hr>

          <h3>Mappa</h3>
          <div id="map" class="map"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="./admin.js"></script>

  <!-- âœ… Service Worker (messo nel punto giusto) -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js");
    }
  </script>
</body>
</html>
